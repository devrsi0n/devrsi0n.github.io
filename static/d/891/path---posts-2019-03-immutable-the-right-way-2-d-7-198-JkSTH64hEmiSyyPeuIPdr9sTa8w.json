{"data":{"site":{"siteMetadata":{"title":"Devrsi0n","author":"Devrsi0n"}},"markdownRemark":{"id":"48c0f8cd-4f2b-50f4-8e65-8e63ef84334d","html":"<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b28b1769d380106568560cc6bdfbb54c/82472/immutable.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUCAwQG/8QAFgEBAQEAAAAAAAAAAAAAAAAAAwAB/9oADAMBAAIQAxAAAAHRPnamN4Jzb//EABkQAQADAQEAAAAAAAAAAAAAAAEAAhEDEP/aAAgBAQABBQKttiR642Xws5//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAZEAEAAgMAAAAAAAAAAAAAAAAAATEQMkH/2gAIAQEABj8Ccarxcv/EAB0QAAICAQUAAAAAAAAAAAAAAAABESExQXGBkdH/2gAIAQEAAT8hRpjcYpsOgvyQsuyW8tntR//aAAwDAQACAAMAAAAQNM//xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQMBAT8QCxv/xAAZEQACAwEAAAAAAAAAAAAAAAAAAREhMVH/2gAIAQIBAT8QdYSuH//EAB0QAQEBAAICAwAAAAAAAAAAAAERAEFRMWFxscH/2gAIAQEAAT8QZk+tfZqCIdt/cmAnmjBoF+W85D2uJABeFv/Z'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"immutable\"\n        title=\"\"\n        src=\"/static/b28b1769d380106568560cc6bdfbb54c/82472/immutable.jpg\"\n        srcset=\"/static/b28b1769d380106568560cc6bdfbb54c/f544b/immutable.jpg 200w,\n/static/b28b1769d380106568560cc6bdfbb54c/41689/immutable.jpg 400w,\n/static/b28b1769d380106568560cc6bdfbb54c/82472/immutable.jpg 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n      />\n  </span>\n  </a></p>\n<h2 id=\"什么是-immutable？\"><a href=\"#%E4%BB%80%E4%B9%88%E6%98%AF-immutable%EF%BC%9F\" aria-label=\"什么是 immutable？ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>什么是 immutable？</h2>\n<p>immutable 是<a href=\"https://zh.wikipedia.org/wiki/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B\">函数式编程</a>中持久化数据结构的概念，immutable 的数据一旦创建就不能再被更改。对 immutable 数据的任何修改、添加或删除都会返回一个新的 immutable 数据。</p>\n<h2 id=\"为什么-javascript-需要-immutable？\"><a href=\"#%E4%B8%BA%E4%BB%80%E4%B9%88-javascript-%E9%9C%80%E8%A6%81-immutable%EF%BC%9F\" aria-label=\"为什么 javascript 需要 immutable？ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>为什么 JavaScript 需要 immutable？</h2>\n<p>React 社区 Redux 是最热门的状态管理库之一，Redux 的 reducer 要求之一就是 immutable，<a href=\"https://github.com/markerikson/redux-ecosystem-links/blob/master/immutable-data.md#immutable-update-utilities\">redux-ecosystem-links/immutable-data</a>页面包含多达 83 个 immutable 库来帮助开发者减少 immutable 模版代码。</p>\n<h2 id=\"javascript-immutable-lib-推荐\"><a href=\"#javascript-immutable-lib-%E6%8E%A8%E8%8D%90\" aria-label=\"javascript immutable lib 推荐 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JavaScript immutable lib 推荐</h2>\n<p>自从 ES2018 支持 Spread operator 之后，直接写对象的浅拷贝简单了很多，比如：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> obj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  foo<span class=\"token punctuation\">:</span> <span class=\"token string\">'bar'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> clonedObj <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>obj <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// obj !== clonedObj</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这类原生语法只能解决 immutable 很小一部分问题，复杂操作还是需要 lib 的支持。目前社区 2 款相关的 lib 热度最高，其一是 Facebook 出品的 <a href=\"https://github.com/immutable-js/immutable-js\">immutable-js</a>，immutable-js 的 API 极其丰富，物极必反这也成为了人们诟病的一点，API 繁多（上百个接口），学习成本高，<a href=\"https://bundlephobia.com/result?p=immutable@4.0.0-rc.12\">63 KB</a> 的包体积也不能称之小巧。其二就是去年大热的 <a href=\"https://github.com/mweststrate/immer\">immer</a>，使用简单，学习成本极小，包体积也非常小 - <a href=\"https://bundlephobia.com/result?p=immer@2.1.5\">12kB</a>。</p>\n<h2 id=\"immer\"><a href=\"#immer\" aria-label=\"immer permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>immer</h2>\n<p>immer 的 slogan ：用直接修改当前状态的方式创新新的状态（Create the next immutable state by mutating the current one\n）。</p>\n<h3 id=\"api\"><a href=\"#api\" aria-label=\"api permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>API</h3>\n<p>最简单的 immer demo。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> produce <span class=\"token keyword\">from</span> <span class=\"token string\">'immer'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> nextState <span class=\"token operator\">=</span> <span class=\"token function\">produce</span><span class=\"token punctuation\">(</span>currentState<span class=\"token punctuation\">,</span> <span class=\"token parameter\">draft</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// empty function</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>nextState <span class=\"token operator\">===</span> currentState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// true</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class=\"language-text\">produce</code> 函数接收 2 个参数，第一个参数是当前的状态（currentState）也就是你想要改变的对象，第二个参数是一个 <code class=\"language-text\">producer</code> 函数，在 <code class=\"language-text\">producer</code> 函数里面用 mutable 的方式操作旧状态以达成你想要的状态。<code class=\"language-text\">producer</code> 函数第一个参数是 <code class=\"language-text\">draft</code>，对 <code class=\"language-text\">draft</code> 的任何修改都会反映到最后生成的状态，而 currentState 不会有任何改动。</p>\n<h2 id=\"参考资料\"><a href=\"#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99\" aria-label=\"参考资料 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考资料</h2>\n<ul>\n<li><a href=\"https://github.com/mweststrate/immer#api\">immer API</a></li>\n<li><a href=\"https://hackernoon.com/introducing-immer-immutability-the-easy-way-9d73d8f71cb3\">Immer: Immutability the easy way</a></li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"/posts/2019/03/immutable-the-right-way/#%E4%BB%80%E4%B9%88%E6%98%AF-immutable%EF%BC%9F\">什么是 immutable？</a></li>\n<li><a href=\"/posts/2019/03/immutable-the-right-way/#%E4%B8%BA%E4%BB%80%E4%B9%88-javascript-%E9%9C%80%E8%A6%81-immutable%EF%BC%9F\">为什么 JavaScript 需要 immutable？</a></li>\n<li><a href=\"/posts/2019/03/immutable-the-right-way/#javascript-immutable-lib-%E6%8E%A8%E8%8D%90\">JavaScript immutable lib 推荐</a></li>\n<li>\n<p><a href=\"/posts/2019/03/immutable-the-right-way/#immer\">immer</a></p>\n<ul>\n<li><a href=\"/posts/2019/03/immutable-the-right-way/#api\">API</a></li>\n</ul>\n</li>\n<li><a href=\"/posts/2019/03/immutable-the-right-way/#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99\">参考资料</a></li>\n</ul>","timeToRead":2,"frontmatter":{"title":"用正确的方式打开 JavaScript immutable 的大门","date":"2019 01 16","spoiler":"immer - JavaScript 使用 immutable 的正确姿势"},"fields":{"slug":"/posts/2019/03/immutable-the-right-way/"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/2019/03/immutable-the-right-way/","previous":{"fields":{"slug":"/posts/2019/01/a-guide-to-chinese-font-for-web-developer/"},"frontmatter":{"title":"Web 开发中文字体指南"}},"next":null}}